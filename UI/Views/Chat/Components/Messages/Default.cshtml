@model Messenger

@{
    var chat = Model?.Dialogs?.FirstOrDefault();
}

@if (chat != null)
{
    <input type="hidden" id="@($"temp_{chat.IdInterlocutor}")" data-id-last-message="@chat.Messages.FirstOrDefault()?.Id" data-load-all-messages="@(chat.Messages.Count < 15 ? true : false)" />

    foreach (var m in chat.Messages)
    {
        if (m.IdUserFrom != chat.IdInterlocutor)
        {
            if (m.Type == MessageType.Message)
            {
                <div class="d-flex flex-row justify-content-start">
                    <img src="@Model.Sheet.Personal.AvatarSmall" alt="owner" class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                    <div>
                        <p class="small p-2 ms-3 mb-1 rounded-3 text-black" style="background-color: #e3ebf7;">
                            @m.Content.Message
                        </p>
                        <p class="small ms-3 mb-3 rounded-3 text-muted float-end">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                    </div>
                </div>
            }
            else if (m.Type == MessageType.Photo_batch)
            {
                foreach (var photo in m.Content.Photos)
                {
                    <div class="d-flex flex-row justify-content-start">
                        <img src="@Model.Sheet.Personal.AvatarSmall" alt="owner" class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                        <div class="col-3 ms-3">
                            <img src="@photo.Url" class="img-thumbnail w-100" />
                            <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                        </div>
                    </div>
                }
            }
            else if (m.Type == MessageType.Sticker)
            {
                <div class="d-flex flex-row justify-content-start">
                    <img src="@Model.Sheet.Personal.AvatarSmall" alt="owner" class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                    <div class="col-3 ms-3">
                        <img src="@m.Content.Url" class="img-thumbnail" />
                        <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                    </div>
                </div>
            }
        }
        else
        {
            switch (m.Type)
            {
                case MessageType.Message:
                    <div class="d-flex flex-row justify-content-end">
                        <div>
                            <p class="small p-2 me-3 mb-1 rounded-3 text-white bg-primary">
                                @m.Content.Message
                            </p>
                            <p class="small me-3 mb-3 rounded-3 text-muted float-end">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                        </div>
                        <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                    </div>
                    break;

                case MessageType.Photo_batch:
                    foreach (var photo in m.Content.Photos)
                    {
                        <div class="d-flex flex-row justify-content-end">
                            <div class="col-3 me-3">
                                <img src="@photo.Url" class="img-thumbnail w-100" />
                                <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                            </div>
                            <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                        </div>
                    }
                    break;

                case MessageType.Sticker:
                    <div class="d-flex flex-row justify-content-end">
                        <div class="col-3 me-3">
                            <img src="@m.Content.Url" class="img-thumbnail" />
                            <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                        </div>
                        <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                    </div>
                    break;

                case MessageType.LikePhoto:
                    if (string.IsNullOrWhiteSpace(m.Content.Url))
                    {
                        <div class="d-flex flex-row justify-content-end">
                            <div class="col-auto me-3">
                                <p class="small p-2 mb-1 rounded-3 text-white bg-primary">
                                    👍 Liked the
                                    <a href="#!" class="ps-1 link-secondary" onclick="showLikedPhoto(@m.Content.IdPhoto)">photo</a>
                                </p>
                                <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                            </div>
                            <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                        </div>
                    }
                    else
                    {
                        <div class="d-flex flex-row justify-content-end">
                            <div class="col-3 me-3">
                                <p class="small p-2 mb-1 rounded-3 text-white bg-primary">
                                    👍 Liked the photo
                                    <a href="#!" onclick="showLikedPhoto(@m.Content.IdPhoto)">
                                        <img src="@m.Content.Url" class="img-thumbnail w-100" />
                                    </a>
                                </p>
                                <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                            </div>
                            <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                        </div>
                    }
                    break;

                case MessageType.Like_NewsFeed_Post:
                    <div class="d-flex flex-row justify-content-end">
                        <div class="col-3 me-3">
                            <p class="small p-2 mb-1 rounded-3 text-white bg-primary">
                                👍 Liked the newsfeed post
                                <br>
                                <span class="small text-white-50">@m.Content.Text</span>
                                <br>
                                <img src="@m.Content.Photos[0].Url" class="img-thumbnail w-100" />
                            </p>
                            <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                        </div>
                        <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                    </div>
                    break;

                case MessageType.Wink:
                    <div class="d-flex flex-row justify-content-end">
                        <div class="col-auto me-3">
                            <p class="small p-2 mb-1 rounded-3 text-white text-center bg-primary">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18z" fill="#FFD93B"></path><path d="m5.91 10.096-.33.682.706-.282c.088-.036 2.22-.846 4.546 1.057l.746.605c-.886-2.941-4.33-4.831-5.668-2.062z" fill="#3E4347"></path><path d="M17.876 10.766c-.057 1.388-1.199 2.52-2.542 2.52-1.348 0-2.391-1.132-2.334-2.52.057-1.388 1.194-2.52 2.543-2.52 1.343 0 2.39 1.132 2.333 2.52z" fill="#fff"></path><path d="M16.024 10.972a1.314 1.314 0 1 1-2.632.007 1.314 1.314 0 0 1 2.632-.007zM17.756 15.024a6.043 6.043 0 0 1-5.754 4.202 6.05 6.05 0 0 1-5.76-4.202.45.45 0 0 1 .523-.568 26.24 26.24 0 0 0 10.468 0c.337-.068.63.242.523.568z" fill="#3E4347"></path><path d="M16.425 14.598c-2.949.503-5.898.503-8.851 0C8.131 16.102 9.9 16.511 12 16.511s3.868-.408 4.425-1.913z" fill="#fff"></path><path d="M12.002 19.226a6.004 6.004 0 0 0 3.149-.889c-.399-.864-1.734-1.501-3.324-1.501-1.485 0-2.747.556-3.233 1.334a6.006 6.006 0 0 0 3.408 1.056z" fill="#E24B4B"></path></svg>
                                <br>
                                Winked
                            </p>
                            <p class="small rounded-3 text-muted float-end text-nowrap">@m.DateCreated.ToString("HH:mm dd.MM.yyyy")</p>
                        </div>
                        <img src="@chat.Avatar" alt="avatar " class="rounded-circle d-flex" style="width: 45px; height: 100%" />
                    </div>
                    break;
            }
        }
    }
}
else
{
    <div class="row h-100">
        <div class="d-flex justify-content-center align-items-center">No messages</div>
    </div>
}