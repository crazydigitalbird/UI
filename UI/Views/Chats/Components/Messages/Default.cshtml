@using Humanizer
@model Messenger

@{
    var chat = Model?.Dialogs?.FirstOrDefault();
    bool newSendMessage = ViewData.ContainsKey("newSendMessage");
}

@if (chat != null)
{
    if (!newSendMessage)
    {
        <input type="hidden" id="temp_chat" data-id-last-message="@chat.Messages.FirstOrDefault()?.Id" data-load-all-messages="@(chat.Messages.Count < 15 ? true : false)" />
    }

    foreach (var m in chat.Messages)
    {
        bool isOwner = m.IdUserFrom != chat.IdInterlocutor;

        if (m.Type == MessageType.Photo_batch)
        {
            foreach (var photo in m.Content.Photos)
            {
                <div class="large-block__body-item mt-2 me-1">
                    <div class="large-block__body-item-top d-flex align-items-end @(isOwner? "flex-row-reverse" : "")">
                        <div class="large-block__body-item-image  @(isOwner? "position-relative ms-2" : "me-2")">
                            <div class="standart-image-block position-relative">
                                <img src="@(isOwner ? Model.Sheet.Personal.AvatarSmall: chat.Avatar)" alt="No person image" class="small-image rounded">
                                @*<span class="large-block-header-status-green d-inline-block position-absolute rounded-circle bottom-0 end-0"></span>*@
                            </div>
                        </div>
                        <div name="message" class="@(isOwner ? "large-block__body-item-message-answer rounded-start" : "large-block__body-item-message rounded-end") d-flex align-items-center justify-content-start p-2 rounded-top" data-id-message="@m.Id">
                            <p class="text-white large-block__body-item-text">
                                <img src="@photo.Url" class="img-thumbnail" style="width: 100px;" />
                            </p>
                        </div>
                    </div>

                    <p class="large-block__body-item-small-text @(isOwner? "text-end" : "text-start")">
                        @m.DateCreated.Humanize()
                    </p>
                </div>
            }
        }
        else if (m.Type == MessageType.System)
        {
            <div class="large-block__body-item mt-2 me-2">
                <div class="large-block__body-item-top d-flex align-items-center justify-content-center">
                    <div class="large-block__body-item-message d-flex align-items-center p-2 rounded-top rounded-end w-100">
                        <p class="text-white large-block__body-item-text w-100">
                            @m.Content.Message
                        </p>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="large-block__body-item mt-2 me-1">
                <div class="large-block__body-item-top d-flex align-items-end @(isOwner? "flex-row-reverse" : "")">
                    <div class="large-block__body-item-image @(isOwner? "position-relative ms-2" : "me-2")">
                        <div class="standart-image-block position-relative">
                            <img src=@(isOwner ? Model.Sheet.Personal.AvatarSmall: chat.Avatar) alt="No person image" class="small-image rounded">
                            @*<span class="large-block-header-status-green d-inline-block position-absolute rounded-circle bottom-0 end-0"></span>*@
                        </div>
                    </div>
                    <div name="message" class="@(isOwner ? "large-block__body-item-message-answer rounded-start" : "large-block__body-item-message rounded-end") d-flex align-items-center justify-content-start p-2 rounded-top" data-id-message="@m.Id">
                        <p class="text-white large-block__body-item-text">
                            @switch (m.Type)
                            {
                                case MessageType.Message:
                                    @m.Content.Message

                                    break;

                                case MessageType.Photo:
                                case MessageType.Sticker:
                                    <img src="@m.Content.Url" class="img-thumbnail" style="width: 100px;" />
                                    break;

                                case MessageType.Video:
                                    <span class="rounded video-msg" style="background-image: url(@m.Content.Url); background-size: auto 100%;">
                                        <svg name="play-svg" class="" width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg" style="top: auto;">
                                            <path d="M17.5 35C7.83243 35 0 27.1676 0 17.5C0 7.83243 7.83243 0 17.5 0C27.1676 0 35 7.83243 35 17.5C35 27.1676 27.1676 35 17.5 35Z" fill="#7D6AF0"></path>
                                            <path d="M24.5819 14.5531L16.1951 10.3141C14.0007 9.21723 11.3855 10.7884 11.3855 13.2192V21.6973C11.3855 24.1281 14.0007 25.6993 16.1951 24.6024L24.5819 20.3634C26.9867 19.148 26.9867 15.7685 24.5819 14.5531Z" fill="white"></path>
                                        </svg>
                                    </span>
                                    break;

                                case MessageType.Photo_batch:
                                    break;

                                case MessageType.Virtual_Gift:
                                    <img src="@m.Content.ImageSrc" class="img-thumbnail" style="width: 100px;" />
                                    <br />
                                    @:@m.Content.Message
                                    break;

                                case MessageType.Wink:
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18z" fill="#FFD93B"></path><path d="m5.91 10.096-.33.682.706-.282c.088-.036 2.22-.846 4.546 1.057l.746.605c-.886-2.941-4.33-4.831-5.668-2.062z" fill="#3E4347"></path><path d="M17.876 10.766c-.057 1.388-1.199 2.52-2.542 2.52-1.348 0-2.391-1.132-2.334-2.52.057-1.388 1.194-2.52 2.543-2.52 1.343 0 2.39 1.132 2.333 2.52z" fill="#fff"></path><path d="M16.024 10.972a1.314 1.314 0 1 1-2.632.007 1.314 1.314 0 0 1 2.632-.007zM17.756 15.024a6.043 6.043 0 0 1-5.754 4.202 6.05 6.05 0 0 1-5.76-4.202.45.45 0 0 1 .523-.568 26.24 26.24 0 0 0 10.468 0c.337-.068.63.242.523.568z" fill="#3E4347"></path><path d="M16.425 14.598c-2.949.503-5.898.503-8.851 0C8.131 16.102 9.9 16.511 12 16.511s3.868-.408 4.425-1.913z" fill="#fff"></path><path d="M12.002 19.226a6.004 6.004 0 0 0 3.149-.889c-.399-.864-1.734-1.501-3.324-1.501-1.485 0-2.747.556-3.233 1.334a6.006 6.006 0 0 0 3.408 1.056z" fill="#E24B4B"></path></svg>
                                    <br>
                                    @:Winked
                                    break;

                                case MessageType.LikePhoto:
                                    @if (string.IsNullOrWhiteSpace(m.Content.Url))
                                    {
                                        @:👍 Liked the
                                        <a href="#!" class="ps-1 link-secondary" onclick="showLikedPhoto(@m.Content.IdPhoto)">photo</a>
                                    }
                                    else
                                    {
                                        @:👍 Liked the photo
                                        <a href="#!" onclick="showLikedPhoto(@m.Content.IdPhoto)">
                                            <img src="@m.Content.Url" class="img-thumbnail" />
                                        </a>
                                    }
                                    break;

                                case MessageType.Like_NewsFeed_Post:
                                    @:👍 Liked the newsfeed post
                                    <br>
                                    <span class="small text-white-50">@m.Content.Text</span>
                                    <br>
                                    <img src="@m.Content.Photos[0].Url" class="img-thumbnail" />
                                    break;

                                case MessageType.Post:
                                    try
                                    {
                                        var count = m.Content.Photos?.Count + m.Content.Videos?.Count;
                                        var videos = m.Content.Videos.Select(v => new { IsVideo = true, Url = v.Url });
                                        var photos = m.Content.Photos.Select(p => new { IsVideo = false, Url = p.Url });
                                        var media = videos.Concat(photos).ToArray();
                                        switch (count)
                                        {
                                            case 1:
                                                <div class="d-flex justify-content-center  text-white">
                                                    <div class="history-posts d-inline-flex flex-column">
                                                        <div class="history">
                                                            <div class="history-item">
                                                                <p class="history-item__text">Exclusive Post</p>
                                                                <div class="history-head">
                                                                    <img src="@media.FirstOrDefault().Url" alt="">
                                                                </div>
                                                                <p class="history-item__text">@m.Content.TextPreview</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                break;

                                            case 2:
                                                <div class="d-flex justify-content-center  text-white">
                                                    <div class="history-posts d-inline-flex flex-column">
                                                        <div class="history">
                                                            <div class="history-item">
                                                                <p class="history-item__text">Exclusive Post</p>
                                                                <div class="d-flex justify-content-between">
                                                                    <div class="history-head">
                                                                        <img src="@media.FirstOrDefault().Url" alt="">
                                                                    </div>
                                                                    <div class="history-main d-flex justify-content-between flex-column">
                                                                        <img src="@media.LastOrDefault().Url" alt="">
                                                                    </div>
                                                                </div>
                                                                <p class="history-item__text">@m.Content.TextPreview</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                break;

                                            default:
                                                <div class="d-flex justify-content-center  text-white">
                                                    <div class="history-posts d-inline-flex flex-column">
                                                        <div class="history">
                                                            <div class="history-item">
                                                                <p class="history-item__text">Exclusive Post</p>
                                                                <div class="d-flex justify-content-between">
                                                                    <div class="history-head">
                                                                        <img src="@media.FirstOrDefault().Url" alt="">
                                                                    </div>
                                                                    <div class="history-main d-flex justify-content-between flex-column">
                                                                        <div class="history-main-sup">
                                                                            <img src="@media[1].Url" alt="" />
                                                                        </div>
                                                                        @if (count > 3)
                                                                        {
                                                                            <div class="history-main-box position-relative">
                                                                                <img src="@media[2].Url" alt="">
                                                                                <div class="upload_count position-absolute">+<span class="count">@($"{(count - 3)}")</span></div>
                                                                            </div>
                                                                        }
                                                                        else
                                                                        {
                                                                            <div class="history-main-sup">
                                                                                <img src="/image/girl.png" alt="">
                                                                            </div>
                                                                        }
                                                                    </div>
                                                                </div>
                                                                <p class="history-item__text">@m.Content.TextPreview</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                break;
                                        }
                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    break;
                            }
                        </p>
                    </div>
                </div>
                <p class="large-block__body-item-small-text @(isOwner? "text-end" : "text-start")">
                    @m.DateCreated.Humanize()
                </p>
            </div>
        }
    }
}
else
{
    <div class="large-block__body-item mt-2 me-2">
        <div class="large-block__body-item-top d-flex align-items-center justify-content-center">
            <div class="large-block__body-item-message d-flex align-items-center p-2 rounded-top rounded-end w-100">
                <p class="text-white large-block__body-item-text w-100">
                    No messages
                </p>
            </div>
        </div>
    </div>
}





























@*<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Hot Atletic Body you have!
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>
<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text fst-italic">
                Майку нравиться Ваше
                <a href="http://test1.ismail.website/#" class="fst-italic">фото</a>
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>
<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Sister is a young teen
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end flex-row-reverse">
        <div class="large-block__body-item-image ms-2 position-relative">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-green d-inline-block position-absolute rounded-circle bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message-answer d-flex align-items-center justify-content-start p-2 rounded-top rounded-start">
            <p class="text-white large-block__body-item-text">
                Sister is a young teen
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-end">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Sister is a young teen
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Are you still away?
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Are you still away?
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Sister is a young teen
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Are you still away?
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>

<div class="large-block__body-item mt-2">
    <div class="large-block__body-item-top d-flex align-items-end">
        <div class="large-block__body-item-image me-2">
            <div class="standart-image-block position-relative">
                <img src="~/image/layout/place-holder-b-person.jpg" alt="No person image" class="small-image rounded">
                <span class="large-block-header-status-red rounded-circle d-inline-block position-absolute bottom-0 end-0"></span>
            </div>
        </div>
        <div class="large-block__body-item-message d-flex align-items-center justify-content-start p-2 rounded-top rounded-end">
            <p class="text-white large-block__body-item-text">
                Are you still away?
            </p>
        </div>
    </div>

    <p class="large-block__body-item-small-text text-start">
        3 ч назад
    </p>
</div>*@