@using System.Globalization;
@model IEnumerable<SheetView>

@{
    Layout = "_LayoutGrid";
    ViewData["Title"] = "Operator";
    int counter = 1;
    var rnd = new Random();
}

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.21.1/bootstrap-table.min.css"
      asp-fallback-href="/lib/bootstrap-table/dist/bootstrap-table.min.css"
      asp-fallback-test-class="fullscreen"
      asp-fallback-test-property="position"
      asp-fallback-test-value="fixed"
      asp-append-version="true" />
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.21.1/extensions/sticky-header/bootstrap-table-sticky-header.min.css"
      asp-fallback-href="/lib/bootstrap-table/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.css"
      asp-fallback-test-class="fix-sticky"
      asp-fallback-test-property="position"
      asp-fallback-test-value="fixed !important"
      asp-append-version="true" />

<input id="initialBalancesByMessageType" type="hidden" value="@ViewData["balancesByMessageType"]" />
<input id="initialBalancesMonth" type="hidden" value="@ViewData["balancesMonth"]" />

<div class="d-grid gap-3 overflow-hidden py-3 px-5" style="grid-template-rows: min-content auto minmax(50%, 1fr);">

    <div class="d-flex">
        <div class="fs-4 fw-bold text-white col">Общий баланс: $ <span>@ViewData["balancesAll"]</span></div>
        <div class="col-4 text-end px-0">
            <partial name="_WorkingShiftPartial" />
        </div>
    </div>

    <div id="containerTable" class="overflow-y-hidden">
        <table id="operatorTable" class="table table-sm table-bordered rounded-1 table-dark overflow-x-hidden"
               data-toggle="operatorTable"
               data-sticky-header="true"
               data-unique-id="id">
            <thead>
                <tr>
                    <th data-field="number" data-width="20px" data-sortable="true" data-align="center" class="text-white-50">#</th>
                    <th data-field="status"></th>
                    <th data-field="name" data-sortable="true">Имя</th>
                    <th data-field="lastName" data-sortable="true">Фамилия</th>
                    <th data-field="sheetId" data-sortable="true" data-align="center">Профиль ID</th>
                    <th data-field="balance" data-formatter="balanceFormatter" class="text-center">Баланс за 30 дней</th>
                    <th data-field="media" class="text-center">Медиа материалы</th>
                    <th data-field="detailedBalance" class="text-center">
                        <div class="d-flex">
                            <div class="col p-0">Чаты</div>
                            <div class="col p-0">Фото</div>
                            <div class="col p-0">Видео</div>
                            <div class="col p-0">Аудио</div>
                            <div class="col p-0">Стикеры</div>
                            <div class="col p-0">Письма</div>
                            <div class="col p-0">Другое</div>
                        </div>
                    </th>
                    <th data-field="id" data-visible="false">ID</th>
                </tr>
                <tr>
                    <th colspan="9"></th>
                </tr>
            </thead>
            <tbody>
                @if (Model?.Count() > 0)
                {
                    foreach (var sheet in Model)
                    {
                        <tr>
                            <td class="text-white-50">@counter</td>

                            <td class="text-center">
                                <div class="d-flex justify-content-center">
                                    <div class="position-relative d-inline-flex">
                                        <img src="@sheet.Avatar" loading="lazy" alt="avatar" class="avatar rounded" onerror="errorLoadAvatar(this)">
                                        @if (sheet.Status == Status.Online)
                                        {
                                            <span class="status-circle-green rounded-circle position-absolute bottom-0 end-0"></span>
                                        }
                                        else
                                        {
                                            <span class="status-circle-red rounded-circle position-absolute bottom-0 end-0"></span>
                                        }
                                    </div>
                                </div>
                            </td>

                            <td class="text-start ps-2">@sheet.FirstName</td>

                            <td class="text-start ps-2">@sheet.LastName</td>

                            <td>@sheet.SheetId</td>

                            <td>@sheet.Balance</td>

                            <td>
                                <div class="d-flex">
                                    <div class="col" title="Photo">
                                        <div class="d-flex">
                                            <div class="col-4 pe-1 text-end">
                                                <i class="fa-solid fa-image fa-fw pe-1 text-white-50"></i>
                                            </div>
                                            <div class="col-8 text-start">
                                                @sheet.Photo
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col" title="Video">
                                        <div class="d-flex">
                                            <div class="col-4 pe-1 text-end">
                                                <i class="fa-solid fa-video fa-fw pe-1 text-white-50"></i>
                                            </div>
                                            <div class="col-8 text-start">
                                                @sheet.Video
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col" title="Audio">
                                        <div class="d-flex">
                                            <div class="col-4 pe-1 text-end">
                                                <i class="fa-solid fa-volume-high fa-fw pe-1 text-white-50"></i>
                                            </div>
                                            <div class="col-8 text-start">
                                                @sheet.Audio
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>

                            <td>
                                <div class="d-flex">
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                    <div class="col p-0">@rnd.Next(0, 5000)</div>
                                </div>
                            </td>

                            <td>@sheet.Id</td>
                        </tr>
                        counter++;
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="grid text-white">
        <div class="row">
            <div class="d-flex justify-content-center col-6">
                <div class="months d-flex justify-content-center align-items-center w-25 border rounded p-1">
                    <div class="col-2 d-flex h-100 justify-content-center">
                        <a href="#!" class="btn btn-sm py-0 d-flex h-100 align-items-center" onclick="downDateTypeChart()">
                            <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 8.825L2.2915 5L6 1.175L4.8583 0L0 5L4.8583 10L6 8.825Z" fill="#9292A3" />
                            </svg>
                        </a>
                    </div>
                    <div id="dateTypeChart" class="col-8 d-flex justify-content-center">@($"{DateTime.Now.ToString("MMMM yyyy", CultureInfo.CreateSpecificCulture("ru-RU"))}")</div>
                    <div class="col-2 d-flex h-100 justify-content-center">
                        <a href="#!" class="btn btn-sm py-0 d-flex h-100 align-items-center" onclick="upDateTypeChart()">
                            <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M-1.92948e-07 1.175L3.7085 5L-1.92948e-07 8.825L1.1417 10L6 5L1.1417 2.38419e-07L-1.92948e-07 1.175Z" fill="#9292A3" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-center col-6">
                <div class="col-4"></div>
                <div class="col-4 d-flex justify-content-center">
                    <div class="months d-flex justify-content-center align-items-center w-75 border rounded p-1">
                        <div class="col-2 d-flex h-100 justify-content-center">
                            <a href="#!" class="btn btn-sm py-0 d-flex h-100 align-items-center" onclick="downDateBalancesAllMonthChart()">
                                <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6 8.825L2.2915 5L6 1.175L4.8583 0L0 5L4.8583 10L6 8.825Z" fill="#9292A3" />
                                </svg>
                            </a>
                        </div>
                        <div id="dateBalanceAllMonth" class="col-8 d-flex h-100 justify-content-center">@($"{DateTime.Now.ToString("MMMM yyyy", CultureInfo.CreateSpecificCulture("ru-RU"))}")</div>
                        <div class="col-2 d-flex h-100 justify-content-center">
                            <a href="#!" class="btn btn-sm py-0 d-flex h-100 align-items-center" onclick="upDateBalancesAllMonthChart()">
                                <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M-1.92948e-07 1.175L3.7085 5L-1.92948e-07 8.825L1.1417 10L6 5L1.1417 2.38419e-07L-1.92948e-07 1.175Z" fill="#9292A3" />
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-4 d-flex justify-content-end align-items-center pe-3">
                    Всего: $<span id="balanceAllMonth"></span>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-6 h-100">
                <div class="chart-wrap h-100">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>
            <div class="col-6 h-100">
                <div class="chart-wrap h-100">
                    <canvas id="balanceMonthChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalComments" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content gradient-custom">
        </div>
    </div>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11;">
    <div id="toast" class="toast text-white" role="alert" aria-live="assertive" aria-atomic="true" data-autohide="true" data-mdb-delay="5000">
        <div class="d-flex">
            <div id="toastBody" class="toast-body text-wrap">
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-mdb-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"
        asp-fallback-src="/js/moment-with-locales.min.js"
        asp-fallback-test="window.moment"
        asp-append-version="true">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.21.1/bootstrap-table.min.js"
        asp-fallback-src="/lib/bootstrap-table/dist/bootstrap-table.min.js"
        asp-fallback-test="window.BootstrapTable"
        asp-append-version="true">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.21.1/extensions/sticky-header/bootstrap-table-sticky-header.min.js"
        asp-fallback-src="/lib/bootstrap-table/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"
        asp-fallback-test="window.BootstrapTable.DEFAULTS.stickyHeader"
        asp-append-version="true">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.3.0/chart.min.js"
        asp-fallback-src="/js/chart.min.js"
        asp-fallback-test="window.Chart"
        asp-append-version="true">
    </script>
    <partial name="_ValidationScriptsPartial" />
    <script src="/js/Operator/operator.js" asp-append-version="true"></script>
    <script src="/js/workingShift.js" asp-append-version="true"></script>
}